import pandas as pd
import streamlit as st
import plotly.express as px

# ----------------- í˜ì´ì§€ ì„¤ì • -----------------
st.set_page_config(page_title="ì¸ì •í‰ê°€ ë¶€ì í•© ë¶„ì„(ISO/IEC 17021-1 ê¸°ë°˜)", layout="wide")

# ----------------- ìƒë‹¨ ë¡œê³  + ì œëª© -----------------
st.markdown(
    """
    <div style="display:flex; align-items:center;">
        <img src="https://img.icons8.com/color/96/000000/book.png" width="60" style="margin-right:15px"/>
        <h1 style="margin:0;"> ë¶€ì í•© ì‘ì„± ê°€ì´ë“œ</h1>
    </div>
    """,
    unsafe_allow_html=True,
)

# ----------------- ê°€ì´ë“œ íƒ­ -----------------
tab1, tab2, tab3 = st.tabs(["ğŸ“– ë¶€ì í•© ì •ì˜", "âœï¸ ë¶€ì í•© ì‘ì„±ë²•", "âš–ï¸ ë¶€ì í•© vs ê¶Œê³ ì‚¬í•­"])

with tab1:
    st.markdown("""
### ë¶€ì í•© (Nonconformity)ì´ë€
**ISO ì •ì˜**  
> *non-fulfillment of a requirement*  

ì¦‰, ì–´ë–¤ ìš”êµ¬ì‚¬í•­(requirement) ì„ ì¶©ì¡±í•˜ì§€ ëª»í•œ ìƒíƒœë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.  

ISO 9001 ì‹¬ì‚¬ ì‹¤í–‰ ì§€ì¹¨ ë“± ISO Auditing Practices Group ë¬¸ì„œì—ì„œë„ ì´ ì •ì˜ë¥¼ ì‚¬ìš©í•˜ë©°, ë¶€ì í•©ì„ ë¬¸ì„œí™”í•  ë•ŒëŠ” **â€œìš”êµ¬ì‚¬í•­ ìœ„ë°˜ â†’ ê°ê´€ì  ì¦ê±° â†’ ì›ì¸ â†’ ì‹œì • ì¡°ì¹˜ â†’ ì¬ë°œ ë°©ì§€ ê³„íšâ€** ì²´ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤.  

ì¸ì¦ì‹¬ì‚¬ ê°€ì´ë“œë¼ì¸ì¸ ISO 19011:2018ì—ì„œëŠ” â€œaudit findings (ë°œê²¬ì‚¬í•­, ì‹¬ì‚¬ê²°ê³¼)â€ ê°œë…ì„ ë‹¤ë£¨ë©°, ì‹¬ì‚¬ê²°ê³¼ëŠ” ê¸°ì¤€(criterion) ëŒ€ë¹„ í˜„ì‹¤(ì‹¤ì œìƒíƒœ)ì„ í‰ê°€í•œ ê²°ê³¼ë¡œì„œ, conformity ë˜ëŠ” nonconformity ê°€ ë  ìˆ˜ ìˆë‹¤ê³  ê·œì •í•©ë‹ˆë‹¤. 
ë”°ë¼ì„œ ISO ì²´ê³„ì—ì„œ ë¶€ì í•©ì€ â€œì‹¬ì‚¬ê¸°ì¤€(í‘œì¤€, ê·œì •, ë‚´ë¶€ ë¬¸ì„œ ë“±) ì¤‘ í•˜ë‚˜ ì´ìƒì˜ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ì§€ ëª»í•œ ìƒíƒœâ€ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.
""")

with tab2:
    st.markdown("""
### ë¶€ì í•© ì‘ì„±ë²•
ì•„ë˜ëŠ” ISO 9001 Auditing Practices Group(APG) ë¬¸ì„œì™€ ISO/ISO 19011, ISO 17021-1 ë“±ì— ê¸°ë°˜í•œ ë¶€ì í•© ì‘ì„± ê°€ì´ë“œì…ë‹ˆë‹¤.

**ì£¼ìš” ì›ì¹™ ë° êµ¬ì„±ìš”ì†Œ** 

APG ë¬¸ì„œëŠ” â€œa well-documented nonconformityâ€ë¥¼ ìœ„í•´ ë‹¤ìŒ ì„¸ ë¶€ë¶„ì´ ë°˜ë“œì‹œ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤ê³  ì•ˆë‚´í•©ë‹ˆë‹¤.

(1) ì‹¬ì‚¬ ì¦ê±° (audit evidence) 
(2) ìš”êµ¬ì‚¬í•­ (requirement)
(3) ë¶€ì í•© ì§„ìˆ  (statement of nonconformity)

| í•­ëª© | ì„¤ëª… | ì¶œì²˜ |
|------|------|------|
| **ì‹¬ì‚¬ ì¦ê±°** | ê°ê´€ì  ì‚¬ì‹¤Â·ê¸°ë¡ ë“± êµ¬ì²´ì  ì¦ê±° ëª…ì‹œ | ISO/APG |
| **ìš”êµ¬ì‚¬í•­** | ìœ„ë°˜í•œ ê¸°ì¤€ ì¡°í•­ì„ ëª…í™•íˆ í‘œê¸° | ISO 17021-1 |
| **ë¶€ì í•© ì§„ìˆ ** | ìœ„ë°˜ ë‚´ìš©ì„ ê°„ê²°Â·ëª…í™•í•˜ê²Œ ê¸°ìˆ  | ISO/APG |
| **ì‹œì •Â·ì›ì¸ë¶„ì„Â·ì¬ë°œë°©ì§€** | ì‹œì •(Correction), ì‹œì •ì¡°ì¹˜(CA), ì¬ë°œë°©ì§€ í¬í•¨ | ISO/APG |
| **ê²€ì¦ ë° ì¢…ê²°** | í‰ê°€ì‚¬(ì‹¬ì‚¬ì›)ì´ ì¡°ì¹˜ ìœ íš¨ì„± ê²€ì¦ í›„ ì¢…ê²° | ISO/APG |
""")

with tab3:
    st.markdown("""
### ë¶€ì í•© (Nonconformity) vs ê¶Œê³ ì‚¬í•­ / ê°œì„ ê¸°íšŒ (Recommendation / OFI)ì˜ êµ¬ë³„ â€” "ê¸°ì¤€ê³¼ ì‹¤ì œ êµ¬ë¶„"

ë¶€ì í•©ê³¼ ê¶Œê³ ì‚¬í•­(ë˜ëŠ” â€œê°œì„  ê¸°íšŒ, Observation / OFIâ€)ì€ í‰ê°€ ë° ê´€ë¦¬ ì‹œìŠ¤í…œ ìš´ì˜ ì‹œ ìì£¼ í˜¼ë™ë˜ëŠ” ê°œë…ì´ë¯€ë¡œ, êµ¬ë³„ ê¸°ì¤€ì„ ëª…í™•íˆ ë‘ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì•„ë˜ ê¸°ì¤€ë“¤ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ëª…ë“œë¦½ë‹ˆë‹¤. 

(1) ISO ê´€ì 

ê¶Œê³ ì‚¬í•­/ê°œì„ ê¸°íšŒëŠ” ì •ì˜ëœ ìš©ì–´ê°€ ì•„ë‹˜ ISO 9000 / ISO 19011 / ISO 17021 ë“±ì˜ í‘œì¤€ì—ëŠ” â€œOpportunity for Improvement / Recommendationâ€ ì´ë¼ëŠ” ìš©ì–´ì˜ ê³µì‹ ì •ì˜ëŠ” ì—†ìŠµë‹ˆë‹¤. 

ì‹¬ì‚¬ ì§€ì¹¨ì—ì„œëŠ” ì‹¬ì‚¬ì›ì´ ë¶€ì í•©ì„ ì§€ì ìœ¼ë¡œ í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ë¼ë„ ì‹œìŠ¤í…œ ê°œì„  ê°€ëŠ¥ì„± ë“±ì— ëŒ€í•´ ì˜ê²¬ì„ ì œì‹œí•  ìˆ˜ ìˆìŒì„ ì¸ì •í•˜ì§€ë§Œ, ê¶Œê³ ì‚¬í•­ì€ ì˜ë¬´ ì¡°ì¹˜ í•­ëª©ì€ ì•„ë‹ˆë‹¤ ë¼ëŠ” ì ì´ ê°•ì¡°ë©ë‹ˆë‹¤. 

ISO/IEC 17021-1:2015 (ì¸ì¦ê¸°ê´€ì— ëŒ€í•œ ìš”êµ¬ì‚¬í•­)ì—ì„œëŠ” ê´€ì°°(observation) ë˜ëŠ” ê°œì„  ê¸°íšŒê°€ ì‹ë³„ë˜ê³  ê¸°ë¡ë  ìˆ˜ ìˆìœ¼ë‚˜, í‰ê°€ ê²°ê³¼ê°€ nonconformityì¸ ê²½ìš°ì—ëŠ” ê·¸ê²ƒì„ ê°œì„  ê¸°íšŒë¡œ ê¸°ë¡í•´ì„œëŠ” ì•ˆ ëœë‹¤ê³  ì •ì˜í•˜ê³  ìˆìœ¼ë©°, ê°œì„  ê¸°íšŒëŠ” í‘œì¤€ ìœ„ë°˜ì˜ ì¦ê±°ê°€ ì—†ëŠ” ì˜ì—­ì—ì„œ ì œì‹œ ê°€ëŠ¥í•œ ì¡°ì–¸ ìˆ˜ì¤€ìœ¼ë¡œ ë‹¤ë£¨ì–´ ì§€ê³  ìˆìŠµë‹ˆë‹¤. 

ISO 19011:2018 ì œ6.4.10í•­ì—ì„œëŠ” â€œrecommendations (ê¶Œê³ ì‚¬í•­)â€ ë˜ëŠ” â€œopportunities for improvementâ€ëŠ” ì‹¬ì‚¬ ëª©ì ì— ë”°ë¼ ì œì‹œë  ìˆ˜ ìˆì§€ë§Œ, ì´ëŠ” ì„±ëŠ¥ ê°œì„ ì„ ìœ„í•œ ì˜ê²¬ì´ì§€ í•„ìˆ˜ ì¤€ìˆ˜ ëŒ€ìƒì€ ì•„ë‹ˆë¼ê³  ëª…ì‹œí•©ë‹ˆë‹¤. 

ì¦‰, ISO ì²´ê³„ì—ì„œëŠ” ê¶Œê³ ì‚¬í•­ ë˜ëŠ” ê°œì„ ê¸°íšŒëŠ” í‰ê°€ì‚¬(ì‹¬ì‚¬ì›)ì´ ì œì•ˆí•  ìˆ˜ ìˆëŠ” ê°œì„  ì•„ì´ë””ì–´ ìˆ˜ì¤€ì´ë©°, ë¶€ì í•©ê³¼ëŠ” ë³„ë„ë¡œ ì·¨ê¸‰ë©ë‹ˆë‹¤. 


(2) ***ì‹¤ë¬´ì /íŒë‹¨ ê¸°ì¤€ìœ¼ë¡œì˜ êµ¬ë³„ ìš”ì†Œ*** 

ì•„ë˜ ìš”ì†Œë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ â€œì´ê±´ ë¶€ì í•©ì¸ê°€, ê°œì„  ê¸°íšŒì¸ê°€â€ë¥¼ êµ¬ë³„í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.

| êµ¬ë³„ ê¸°ì¤€ | ë¶€ì í•© (Nonconformity) | ê¶Œê³ ì‚¬í•­ / ê°œì„ ê¸°íšŒ (OFI, Recommendation) |
| -------------------- | ---------------------------------- | --------------------------------------- |
| **ìš”êµ¬ì‚¬í•­ ìœ„ë°˜ ì—¬ë¶€** | ê¸°ì¤€ ë˜ëŠ” ìš”êµ¬ì‚¬í•­ì„ ëª…ë°±íˆ ìœ„ë°˜í•œ ê²½ìš° | ìš”êµ¬ì‚¬í•­ì„ ìœ„ë°˜í•˜ì§€ ì•Šì•˜ì§€ë§Œ ë” ë‚˜ì€ ë°©ë²•ì´ ìˆì„ ê²½ìš° |
| **ì˜ë¬´ ì¡°ì¹˜ ì—¬ë¶€** | ë°˜ë“œì‹œ ì‹œì • ì¡°ì¹˜ê°€ ìš”êµ¬ë¨ | ì¡°ì¹˜ê°€ ì˜ë¬´ëŠ” ì•„ë‹ˆë©° ì¡°ì§ì˜ ì„ íƒ ì‚¬í•­ |
| **ì¸ì¦ ë˜ëŠ” ì í•©ì„± ì˜í–¥ ê°€ëŠ¥ì„±** | ì¸ì¦ ìœ ì§€, ì‹œìŠ¤í…œ ì‹ ë¢°ì„± ë“±ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŒ | ì¼ë°˜ì ìœ¼ë¡œ ì¸ì¦ ë¶ˆì´í–‰ìœ¼ë¡œ ì§ì ‘ ì—°ê²°ë˜ì§€ëŠ” ì•ŠìŒ |
| **ì‹¬ê°ì„± / ìœ„í—˜ë„** | ì‹œìŠ¤í…œ ì·¨ì•½, ë°˜ë³µ ë°œìƒ, ì•ˆì „/í’ˆì§ˆ ì˜í–¥ ë“± | ì£¼ë¡œ íš¨ìœ¨ì„±, ìµœì í™”, ë¹„ìš© ì ˆê° ë“± ê°œì„  ì—¬ì§€ |
| **ëª…ë ¹ì  í‘œí˜„ ì‚¬ìš© ì—¬ë¶€** | â€œ~í•˜ì§€ ì•ŠìŒâ€, â€œ~ì´ ì—†ìŒâ€, â€œ~ë¯¸ì¤€ìˆ˜â€ ë“± ë¶€ì •ì  í‘œí˜„ | â€œ~í•„ìš”í•¨â€, â€œê¶Œì¥ë¨â€, â€œê²€í† í•  í•„ìš” ìˆìŒâ€ ë“± ì œì•ˆí˜• í‘œí˜„ |
""")

st.markdown("---")

# ----------------- ê¸°ë³¸ ë°ì´í„° -----------------
DEFAULT_FINDINGS = pd.DataFrame({
    "ì¸ì •ê¸°ì¤€": ["KAB-R-MSCB"]*6,
    "ì¡°í•­": ["7", "7.1", "7.2", "8.3", "9.1", "9.2"],
    "ì„¸ë¶€ì¡°í•­": ["7.1", "7.1.1", "7.1.2", "8.3.1", "9.1.1", "9.2.2"],
    "êµ¬ë¶„": ["ë¶€ì í•©", "ê¶Œê³ ", "ë¶€ì í•©", "ê¶Œê³ ", "ë¶€ì í•©", "ê¶Œê³ "],
    "ë‚´ìš©": [
        "ì¡°ì§ì€ í’ˆì§ˆê²½ì˜ì‹œìŠ¤í…œ ìì›ì˜ ì¶©ë¶„ì„±ì„ í™•ë³´í•˜ì§€ ëª»í•¨.",
        "í”„ë¡œì„¸ìŠ¤ ìš´ì˜ê³„íšì„œì— ì¸ì› ë°°ì¹˜ê°€ ë¯¸í¡í•¨.",
        "ê³ ê° ìš”êµ¬ì‚¬í•­ ê²€í†  ì ˆì°¨ ë¯¸ì´í–‰.",
        "ë³€ê²½ê´€ë¦¬ ì ˆì°¨ì„œê°€ ìµœì‹ í™”ë˜ì–´ ìˆì§€ ì•ŠìŒ.",
        "ë‚´ë¶€ì‹¬ì‚¬ ê³„íšì´ ì ì‹œì— ìˆ˜ë¦½ë˜ì§€ ì•ŠìŒ.",
        "ê³ ê°ë§Œì¡±ë„ ì¡°ì‚¬ ì ˆì°¨ ê°œì„  í•„ìš”."
    ]
})
DEFAULT_STANDARDS = pd.DataFrame({
    "ì¡°í•­": ["7", "7.1", "7.2", "8.3", "9.1", "9.2"],
    "ìš”êµ¬ì‚¬í•­": [
        "ì¡°ì§ì€ í•„ìš”í•œ ìì›ì„ ê²°ì •í•˜ê³  ì œê³µí•´ì•¼ í•œë‹¤.",
        "ì¡°ì§ì€ ì¸í”„ë¼ë¥¼ í¬í•¨í•œ í•„ìš”í•œ ìì›ì„ ì œê³µí•´ì•¼ í•œë‹¤.",
        "ì¡°ì§ì€ ì¸ì  ìì›ì˜ ì—­ëŸ‰ì„ ë³´ì¥í•´ì•¼ í•œë‹¤.",
        "ì œí’ˆ ë° ì„œë¹„ìŠ¤ ì„¤ê³„ê°œë°œì„ ê´€ë¦¬í•´ì•¼ í•œë‹¤.",
        "ëª¨ë‹ˆí„°ë§ ë° ì¸¡ì •ì„ í†µí•´ ì‹œìŠ¤í…œ ì„±ê³¼ë¥¼ í‰ê°€í•´ì•¼ í•œë‹¤.",
        "ë‚´ë¶€ì‹¬ì‚¬ë¥¼ ê³„íší•˜ê³  ì‹¤ì‹œí•´ì•¼ í•œë‹¤."
    ]
})

# ----------------- ìœ í‹¸ -----------------
def drop_noise_columns(df):
    noise = {"ê¸°ê´€ëª…","í‰ê°€ì¢…ë¥˜","ì‹œì‘ì¼","ì¢…ë£Œì¼","ë°œí–‰ë²ˆí˜¸"}
    unnamed = [c for c in df.columns if str(c).startswith("Unnamed")]
    return df.drop(columns=list(noise)+unnamed, errors="ignore")

def add_req_text(findings, standards):
    if standards is None:
        return findings
    std_cols = standards.columns
    clause_col = next((c for c in std_cols if c in ["ì¡°í•­","Clause","í•­ëª©"]), None)
    req_col = next((c for c in std_cols if c in ["ìš”êµ¬ì‚¬í•­","Requirement","ë‚´ìš©"]), None)
    if not clause_col or not req_col:
        return findings
    std = standards.copy()
    std[clause_col] = std[clause_col].astype(str)
    f = findings.copy()

    # IndexError ë°©ì§€ (ê°’ì´ ì—†ì„ ë•Œ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜)
    def match_req(row):
        sub = str(row.get("ì„¸ë¶€ì¡°í•­"))
        main = str(row.get("ì¡°í•­"))
        if sub in std[clause_col].values:
            vals = std.loc[std[clause_col]==sub, req_col].values
            return vals[0] if len(vals) > 0 else ""
        if main in std[clause_col].values:
            vals = std.loc[std[clause_col]==main, req_col].values
            return vals[0] if len(vals) > 0 else ""
        return ""
    f["ìš”êµ¬ì‚¬í•­"] = f.apply(match_req, axis=1)
    return f

# ----------------- ë°ì´í„° ë¡œë“œ -----------------
uploaded = st.file_uploader("ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ (ì„ íƒ)", type=["xlsx"])
if uploaded:
    findings = pd.read_excel(uploaded, sheet_name=0)
    try:
        standards = pd.read_excel(uploaded, sheet_name=1)
    except:
        standards = DEFAULT_STANDARDS
else:
    st.info("âš ï¸ ì—…ë¡œë“œí•˜ì§€ ì•Šìœ¼ë©´ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.")
    findings, standards = DEFAULT_FINDINGS.copy(), DEFAULT_STANDARDS.copy()

findings = drop_noise_columns(findings)
findings = add_req_text(findings, standards)

# ----------------- ê²€ìƒ‰ ì¡°ê±´ -----------------
st.sidebar.header("ğŸ” ê²€ìƒ‰ ì¡°ê±´")
ì¡°í•­_sel = st.sidebar.multiselect("ì¡°í•­", sorted(findings["ì¡°í•­"].dropna().astype(str).unique()) if "ì¡°í•­" in findings else [])
ì„¸ë¶€ì¡°í•­_sel = st.sidebar.multiselect("ì„¸ë¶€ì¡°í•­", sorted(findings["ì„¸ë¶€ì¡°í•­"].dropna().astype(str).unique()) if "ì„¸ë¶€ì¡°í•­" in findings else [])
êµ¬ë¶„_sel = st.sidebar.multiselect("êµ¬ë¶„ (ë¶€ì í•©/ê¶Œê³ )", sorted(findings["êµ¬ë¶„"].dropna().astype(str).unique()) if "êµ¬ë¶„" in findings else [])
í‚¤ì›Œë“œ = st.sidebar.text_input("ë‚´ìš© ê²€ìƒ‰")
ì¡°í•­ê²€ìƒ‰ = st.sidebar.text_input("ì¡°í•­ ê²€ìƒ‰ (ì˜ˆ: 7 ë˜ëŠ” 7.1)")
if st.sidebar.button("ê²€ìƒ‰ì¡°ê±´ ì´ˆê¸°í™”"):
    st.rerun()  # st.experimental_rerun() ëŒ€ì‹  ìµœì‹ ë²„ì „ í˜¸í™˜
btn_search = st.sidebar.button("ğŸ” ê²€ìƒ‰ ì‹¤í–‰")

# ----------------- í•„í„°ë§ -----------------
df = findings.copy()
if btn_search or any([ì¡°í•­_sel, ì„¸ë¶€ì¡°í•­_sel, êµ¬ë¶„_sel, í‚¤ì›Œë“œ, ì¡°í•­ê²€ìƒ‰]):
    if "ì¡°í•­" in df and ì¡°í•­_sel:
        df = df[df["ì¡°í•­"].astype(str).isin(ì¡°í•­_sel)]
    if "ì„¸ë¶€ì¡°í•­" in df and ì„¸ë¶€ì¡°í•­_sel:
        df = df[df["ì„¸ë¶€ì¡°í•­"].astype(str).isin(ì„¸ë¶€ì¡°í•­_sel)]
    if "êµ¬ë¶„" in df and êµ¬ë¶„_sel:
        df = df[df["êµ¬ë¶„"].astype(str).isin(êµ¬ë¶„_sel)]
    if "ë‚´ìš©" in df and í‚¤ì›Œë“œ:
        df = df[df["ë‚´ìš©"].astype(str).str.contains(í‚¤ì›Œë“œ, case=False, na=False)]
    if ì¡°í•­ê²€ìƒ‰:
        mask = pd.Series(False, index=df.index)
        if "ì¡°í•­" in df:
            mask |= df["ì¡°í•­"].astype(str).str.contains(ì¡°í•­ê²€ìƒ‰, na=False)
        if "ì„¸ë¶€ì¡°í•­" in df:
            mask |= df["ì„¸ë¶€ì¡°í•­"].astype(str).str.contains(ì¡°í•­ê²€ìƒ‰, na=False)
        df = df[mask]

st.markdown("### ğŸ” ê²€ìƒ‰ ê²°ê³¼")

# hide_index=True ëŠ” Streamlit 1.32 ì´ìƒë§Œ ì§€ì› â†’ í˜¸í™˜ì„± ìœ„í•´ ì œê±°
st.dataframe(
    df[[c for c in ["ì¡°í•­","ì„¸ë¶€ì¡°í•­","êµ¬ë¶„","ìš”êµ¬ì‚¬í•­","ë‚´ìš©"] if c in df.columns]],
    use_container_width=True
)

# ----------------- í†µê³„ -----------------
st.markdown("## ğŸ“Š í†µê³„ ë¶„ì„")
if not df.empty:
    if "ì¡°í•­" in df:
        st.markdown("#### 1ï¸âƒ£ ì¡°í•­ë³„ ë°œìƒ ê±´ìˆ˜")
        c1 = df["ì¡°í•­"].astype(str).value_counts().reset_index()
        c1.columns = ["ì¡°í•­","ê±´ìˆ˜"]
        c1["ê±´ìˆ˜"] = c1["ê±´ìˆ˜"].astype(int)
        st.plotly_chart(px.bar(c1, x="ì¡°í•­", y="ê±´ìˆ˜", text="ê±´ìˆ˜", title="ì¡°í•­ë³„ ë°œìƒ ê±´ìˆ˜"), use_container_width=True)
    if "ì„¸ë¶€ì¡°í•­" in df:
        st.markdown("#### 2ï¸âƒ£ ì„¸ë¶€ì¡°í•­ë³„ ë°œìƒ ê±´ìˆ˜")
        c2 = df["ì„¸ë¶€ì¡°í•­"].astype(str).value_counts().reset_index()
        c2.columns = ["ì„¸ë¶€ì¡°í•­","ê±´ìˆ˜"]
        c2["ê±´ìˆ˜"] = c2["ê±´ìˆ˜"].astype(int)
        fig2 = px.bar(c2, x="ì„¸ë¶€ì¡°í•­", y="ê±´ìˆ˜", text="ê±´ìˆ˜", title="ì„¸ë¶€ì¡°í•­ë³„ ë°œìƒ ê±´ìˆ˜")
        fig2.update_xaxes(tickangle=60)
        st.plotly_chart(fig2, use_container_width=True)
    if "êµ¬ë¶„" in df:
        st.markdown("#### 3ï¸âƒ£ ê¶Œê³  / ë¶€ì í•© ë¹„ìœ¨")
        st.plotly_chart(px.pie(df, names="êµ¬ë¶„", title="ê¶Œê³ /ë¶€ì í•© ë¹„ìœ¨"), use_container_width=True)

